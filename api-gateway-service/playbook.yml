- hosts: all
     remote_user: root
     tasks:
       - name: deploy ssh key to account
         authorized_key: user='ec2-user' key="{{lookup('file','/home/ec2-user/.ssh/id_rsa.pub')}}"
  vars:
    ansible_python_interpreter: '/usr/bin/python3'
  tasks:
  - name: Deploy the service
    k8s:
      state: present
      definition: "{{ lookup('template', 'api-gateway-service.yml') | from_yaml }}"
      validate_certs: no
      namespace: default
  - name: Deploy the application
    k8s:
      state: present
      validate_certs: no
      namespace: default
      definition: "{{ lookup('template', 'api-gateway-service-deployment.yml') | from_yaml }}"